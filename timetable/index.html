<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>2026 Academic Timetable Course Lookup</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.datatables.net/1.11.5/css/dataTables.bootstrap5.min.css">
    <style>
        body {
            background-color: #f8f9fa;
        }
        .search-panel {
            background: white;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            padding: 20px;
            margin-bottom: 20px;
        }
        .results-panel {
            background: white;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            padding: 20px;
        }
        #courseTable {
            font-size: 14px;
        }
        .form-control, .form-select {
            border-radius: 6px;
        }
    </style>
</head>
<body>
    <div class="container mt-4">
        <h1 class="mb-4">2026 Academic Timetable Course Lookup</h1>
        
        <div class="row">
            <div class="col-md-3">
                <div class="search-panel">
                    <h4>Find Course</h4>
                    
                    <!-- Quick search -->
                    <div class="mb-3">
                        <label for="fullCourseCode" class="form-label">Enter Full Course Code:</label>
                        <input type="text" class="form-control" id="fullCourseCode" 
                               placeholder="e.g., ACCY231 or mmpa502">
                    </div>
                    
                    <hr>
                    
                    <h5>OR Select Step by Step:</h5>
                    
                    <!-- Two-step selection -->
                    <div class="mb-3">
                        <label for="coursePrefix" class="form-label">Course Prefix:</label>
                        <select class="form-select" id="coursePrefix">
                            <option value="">Select...</option>
                        </select>
                    </div>
                    
                    <div class="mb-3">
                        <label for="courseNumber" class="form-label">Course Number:</label>
                        <select class="form-select" id="courseNumber" disabled>
                            <option value="">Select...</option>
                        </select>
                    </div>
                </div>
            </div>
            
            <div class="col-md-9">
                <div class="results-panel">
                    <h3 id="courseHeader">Enter a course code or select from dropdowns to view timetable information</h3>
                    <div id="tableContainer">
                        <table id="courseTable" class="table table-striped table-hover" style="display: none;">
                            <thead class="table-dark">
                                <tr>
                                    <th>CRN</th>
                                    <th>Type</th>
                                    <th>Students</th>
                                    <th>Dates</th>
                                    <th>Room</th>
                                    <th>Start</th>
                                    <th>Finish</th>
                                    <th>Days</th>
                                </tr>
                            </thead>
                            <tbody></tbody>
                        </table>
                        <div id="noResults" style="display: none;">
                            <div class="alert alert-info">No course information found. Please check the course code.</div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <div class="row mt-4">
            <div class="col-12">
                <div class="search-panel">
                    <h2>Instructions</h2>
                    <p><strong>Two ways to find your course:</strong></p>
                    <p><strong>Option 1 - Quick Search:</strong> Type the full course code directly (e.g., ACCY231, mmpa502, BILD101)</p>
                    <p><strong>Option 2 - Step by Step:</strong></p>
                    <ol>
                        <li><strong>Select Course Prefix:</strong> Choose the first four characters (e.g., ACCY, MMPA, BILD)</li>
                        <li><strong>Select Course Number:</strong> Choose from available numbers for that prefix</li>
                    </ol>
                    <p><strong>Results show all sections for your course with:</strong></p>
                    <ul>
                        <li><strong>CRN:</strong> Course Reference Number</li>
                        <li><strong>Type:</strong> Class type (Lecture, Tutorial, etc.)</li>
                        <li><strong>Students:</strong> Enrollment capacity</li>
                        <li><strong>Dates:</strong> When the course runs</li>
                        <li><strong>Room:</strong> Location</li>
                        <li><strong>Start/Finish:</strong> Class times</li>
                        <li><strong>Days:</strong> Days of the week the class meets</li>
                    </ul>
                    <p><em>Data from: 2026 Academic Timetable - DRAFT 1 - 20250827</em></p>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src="https://cdn.datatables.net/1.11.5/js/jquery.dataTables.min.js"></script>
    <script src="https://cdn.datatables.net/1.11.5/js/dataTables.bootstrap5.min.js"></script>

    <script>
        let timetableData = [];
        let dataTable;

        // Load timetable data
        fetch('timetable_data.json')
            .then(response => response.json())
            .then(data => {
                timetableData = data;
                initializeInterface();
            })
            .catch(error => {
                console.error('Error loading timetable data:', error);
                document.getElementById('courseHeader').textContent = 'Error loading timetable data. Please refresh the page.';
            });

        function initializeInterface() {
            // Initialize DataTable
            dataTable = $('#courseTable').DataTable({
                dom: 't',
                pageLength: -1,
                scrollX: true,
                data: [],
                columns: [
                    { data: 'crn' },
                    { data: 'type' },
                    { data: 'stu' },
                    { data: 'dates', width: '80px' },
                    { data: 'room' },
                    { data: 'start' },
                    { data: 'finish' },
                    { data: 'days' }
                ],
                columnDefs: [
                    { targets: 3, width: '80px' }
                ]
            });

            // Populate course prefixes
            const prefixes = [...new Set(timetableData.map(course => course.course.substring(0, 4)))].sort();
            const prefixSelect = document.getElementById('coursePrefix');
            prefixes.forEach(prefix => {
                const option = document.createElement('option');
                option.value = prefix;
                option.textContent = prefix;
                prefixSelect.appendChild(option);
            });

            // Event listeners
            document.getElementById('fullCourseCode').addEventListener('input', handleFullCourseInput);
            document.getElementById('coursePrefix').addEventListener('change', handlePrefixChange);
            document.getElementById('courseNumber').addEventListener('change', handleNumberChange);
        }

        function handleFullCourseInput() {
            const fullCode = document.getElementById('fullCourseCode').value.trim();
            
            if (fullCode) {
                // Clear dropdowns
                document.getElementById('coursePrefix').value = '';
                document.getElementById('courseNumber').value = '';
                document.getElementById('courseNumber').disabled = true;
                
                searchCourse(fullCode.toUpperCase());
            } else {
                clearResults();
            }
        }

        function handlePrefixChange() {
            const prefix = document.getElementById('coursePrefix').value;
            const numberSelect = document.getElementById('courseNumber');
            
            // Clear full course code input
            document.getElementById('fullCourseCode').value = '';
            
            if (prefix) {
                // Get available numbers for this prefix
                const availableNumbers = [...new Set(
                    timetableData
                        .filter(course => course.course.startsWith(prefix))
                        .map(course => course.course.substring(4))
                )].sort();
                
                // Populate number dropdown
                numberSelect.innerHTML = '<option value="">Select...</option>';
                availableNumbers.forEach(number => {
                    const option = document.createElement('option');
                    option.value = number;
                    option.textContent = number;
                    numberSelect.appendChild(option);
                });
                
                numberSelect.disabled = false;
            } else {
                numberSelect.innerHTML = '<option value="">Select...</option>';
                numberSelect.disabled = true;
                clearResults();
            }
        }

        function handleNumberChange() {
            const prefix = document.getElementById('coursePrefix').value;
            const number = document.getElementById('courseNumber').value;
            
            if (prefix && number) {
                searchCourse(prefix + number);
            } else {
                clearResults();
            }
        }

        function searchCourse(courseCode) {
            const matchingCourses = timetableData.filter(course => 
                course.course.toUpperCase() === courseCode.toUpperCase()
            );
            
            if (matchingCourses.length > 0) {
                document.getElementById('courseHeader').textContent = `Course Information for ${courseCode.toUpperCase()}`;
                
                // Update DataTable
                dataTable.clear().rows.add(matchingCourses).draw();
                document.getElementById('courseTable').style.display = 'table';
                document.getElementById('noResults').style.display = 'none';
            } else {
                document.getElementById('courseHeader').textContent = `No results found for ${courseCode.toUpperCase()}`;
                document.getElementById('courseTable').style.display = 'none';
                document.getElementById('noResults').style.display = 'block';
            }
        }

        function clearResults() {
            document.getElementById('courseHeader').textContent = 'Enter a course code or select from dropdowns to view timetable information';
            document.getElementById('courseTable').style.display = 'none';
            document.getElementById('noResults').style.display = 'none';
            if (dataTable) {
                dataTable.clear().draw();
            }
        }
    </script>
</body>
</html>